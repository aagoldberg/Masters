---
title: "Grando-6H"
author: "John Grando"
date: "April 7, 2017"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
knitr::opts_chunk$set(tidy.opts=list(width.cutoff=60),tidy=TRUE)
```

## Grando 6 Homework

```{r}
if (Sys.info()["sysname"]=="Windows"){
  setwd("~/Masters/DATA606/Week6/Homework")
} else {
  setwd("~/Documents/Masters/DATA606/Week6/Homework")
}
require(ggplot2)
```

####6.6 2010 Healthcare Law. On June 28, 2012 the U.S. Supreme Court upheld the much debated 2010 healthcare law, declaring it constitutional. A Gallup poll released the day after this decision indicates that 46% of 1,012 Americans agree with this decision. At a 95% confidence level, this sample has a 3% margin of error. Based on this information, determine if the following statements are true or false, and explain your reasoning.

####(a) We are 95% confident that between 43% and 49% of Americans in this sample support the decision of the U.S. Supreme Court on the 2010 healthcare law.

Answer:

False. A confidence interval estimates the population proportion and not the sample proportion.

####(b) We are 95% confident that between 43% and 49% of Americans support the decision of the U.S. Supreme Court on the 2010 healthcare law.

Answer:

True.  The statement indicates that the margin of error was calculated based on a 95% confidence level which resulted in a value of 3% and a mean of 46%.

####(c) If we considered many random samples of 1,012 Americans, and we calculated the sample proportions of those who support the decision of the U.S. Supreme Court, 95% of those sample proportions will be between 43% and 49%.

Answer:

True.  This is the definition of a confidence interval.

####(d) The margin of error at a 90% confidence level would be higher than 3%.

Answer:

False, the margin of error would be lower since the z value at a 90% confidence level would be less than that for a 95% confidence interval and the formula for margin of error is as follows:

$$ME\quad =\quad z*\sqrt { \frac { p(1-p) }{ n }  }$$

####6.12 Legalization of marijuana, Part I. The 2010 General Social Survey asked 1,259 US residents: “Do you think the use of marijuana should be made legal, or not?” 48% of the respondents said it should be made legal.

####(a) Is 48% a sample statistic or a population parameter? Explain.

Answer:

It is a sample statistic since it represents the average proportion of the people surveyed responding in the affirmative.

####(b) Construct a 95% confidence interval for the proportion of US residents who think marijuana should be made legal, and interpret it in the context of the data.

Answer:

```{r}
ns = 1259
p_hat = 0.48
z = 1.96
se <- sqrt(p_hat*(1-p_hat)/ns)
ME = 1.96 * se
p_hat - ME
p_hat + ME

lb <- p_hat - se * 4
ub <- p_hat + se * 4
z1 <- round(p_hat - ME, digits = 2)
z2 <- round(p_hat + ME, digits = 2)
pick_line1 <- z1
pick_line2 <- z2
ggplot(data.frame(x = c(lb, ub)), aes(x))+ stat_function(fun = dnorm, args = list(mean=p_hat, sd=se)) + stat_function(fun = dnorm, args = list(mean=p_hat, sd=se), xlim = c(z1, z2),geom = "area", alpha=0.5)+geom_vline(xintercept=pick_line1, color = "black", alpha = 0.75)+geom_text(aes(x=pick_line1, y=10, label=sprintf("p = %s\n", pick_line1)), color="black", angle=90)+geom_vline(xintercept=pick_line2, color = "black", alpha = 0.75)+geom_text(aes(x=pick_line2, y=10, label=sprintf("p = %s\n", pick_line2)), color="black", angle=90) + labs(x="proportion")
```

We are 95% confident that the number of US residents who think the use of marijuana should be made legal is between 45.2% and 50.8%.

####(c) A critic points out that this 95% confidence interval is only accurate if the statistic follows a normal distribution, or if the normal model is a good approximation. Is this true for these data? Explain.

Answer:

We must check the survey for the following elements:

1. Independence: Given that this is an organized survey, and has supporting documentation provided in the footnotes, we can assume that the surveys were sufficiently performed in order to justify that the sample observations were independent.

2. success-failure condition:

The number of successes (affirmatives) are `r ns*p_hat` and failures (negatives) are `r ns*(1-p_hat)`.  The minimum number of successes and failures have been met.

Since both of these conditions are met, we can assume the data follows an approximately normal distribution.


####(d) A news piece on this survey’s findings states, “Majority of Americans think marijuana should be legalized.” Based on your confidence interval, is this news piece’s statement justified?

Answer:

No.  The conficence interval spans between 45.2% and 50.8%.  This means that we are 95% confident that the true mean falls betwen these values which are above (majority) and below (minority) 50%.

####6.20 Legalize Marijuana, Part II. As discussed in Exercise 6.12, the 2010 General Social Survey reported a sample where about 48% of US residents thought marijuana should be made legal. If we wanted to limit the margin of error of a 95% confidence interval to 2%, about how many Americans would we need to survey ?

Answer:

The following fomula summarizes the formula, and rearrangement, for margin of error for a proportional sample.  Since the sample returned a value of p = 0.48, we should use this proportion.  The number of people necessary to sample is:

$$ME\quad =\quad z*\sqrt { \frac { p(1-p) }{ n }  } <\quad 0.02\\ ME\quad =\quad 1.96*\sqrt { \frac { 0.48(1-0.48) }{ n }  } <\quad 0.02\\ ME\quad =\quad { 1.96 }^{ 2 }*\frac { 0.48(1-0.48) }{ n } <\quad { 0.02 }^{ 2 }\\ ME\quad =\quad { 1.96 }^{ 2 }*\frac { 0.48(1-0.48) }{ { 0.02 }^{ 2 } } <\quad n$$

```{r}
ceiling(1.96^2 * 0.48*(1-0.48)/0.02^2)
```

####6.28 Sleep deprivation, CA vs. OR, Part I. According to a report on sleep deprivation by the Centers for Disease Control and Prevention, the proportion of California residents who reported insufficient rest or sleep during each of the preceding 30 days is 8.0%, while this proportion is 8.8% for Oregon residents. These data are based on simple random samples of 11,545 California and 4,691 Oregon residents. Calculate a 95% confidence interval for the difference between the proportions of Californians and Oregonians who are sleep deprived and interpret it in context of the data.

Answer:

First, let's test the conditions for inference:

1. Each sample follows a normal model.

1a. Independence: The reports are indicated to be based on a simple random sample, so it appears okay to proceed.

1b. success-failure condition:

```{r}
phat_CA <- 0.08
n_CA <- 11545
phat_OR <- 0.088
n_OR <- 4691
CA_success <- formatC(phat_CA * n_CA, format = "d", big.mark = ",")
CA_failure <- formatC((1-phat_CA) * n_CA, format = "d", big.mark = ",")
OR_success <- formatC(phat_OR * n_OR, format = "d", big.mark = ",")
OR_failure <- formatC((1-phat_OR) * n_OR, format = "d", big.mark = ",")
```

The number of successes (insufficient sleep) are `r CA_success` and failures (other) are `r CA_failure` for California residents.  The number of successes (insufficient sleep) are `r OR_success` and failures (other) are `r OR_failure` for Oregon residents.  The minimum number of successes and failures have been met.

The confidence interval for the difference between the proportions of Californians and Oregonians who are sleep deprived is:

```{r}
z_value <- 1.96
se_CA <- phat_CA * (1 - phat_CA) / n_CA
se_OR <- phat_OR * (1 - phat_OR) / n_OR
se <- sqrt(se_CA + se_OR)
p_hat <- phat_CA - phat_OR
ME <- z_value * se
p_hat - ME
p_hat + ME

lb <- p_hat - se * 4
ub <- p_hat + se * 4
z1 <- round(p_hat - ME, digits = 4)
z2 <- round(p_hat + ME, digits = 4)
pick_line1 <- z1
pick_line2 <- z2
ggplot(data.frame(x = c(lb, ub)), aes(x))+ stat_function(fun = dnorm, args = list(mean=p_hat, sd=se)) + stat_function(fun = dnorm, args = list(mean=p_hat, sd=se), xlim = c(z1, z2),geom = "area", alpha=0.5)+geom_vline(xintercept=pick_line1, color = "black", alpha = 0.75)+geom_text(aes(x=pick_line1, y=40, label=sprintf("p = %s\n", pick_line1)), color="black", angle=90)+geom_vline(xintercept=pick_line2, color = "black", alpha = 0.75)+geom_text(aes(x=pick_line2, y=40, label=sprintf("p = %s\n", pick_line2)), color="black", angle=90) + labs(x="proportion")
```

We are 95% confident that the difference between the proportions of Californians and Oregonians who are sleep deprived is between -0.0175 and 0.0015.  Since the value of 0 is within the confidence interval, it appears that we would fail to reject the hypothesis that there is no difference between the two groups.

####6.44 Barking deer. Microhabitat factors associated with forage and bed sites of barking deer in Hainan Island, China were examined from 2001 to 2002. In this region woods make up 4.8% of the land, cultivated grass plot makes up 14.7% and deciduous forests makes up 39.6%. Of the 426 sites where the deer forage, 4 were categorized as woods, 16 as cultivated grassplot, and 61 as deciduous forests. The table below summarizes these data.

####(a) Write the hypotheses for testing if barking deer prefer to forage in certain habitats over others.

Answer:

$${ H }_{ O }:\quad The\quad observed\quad data\quad is\quad a\quad random\quad sample,\quad\\ i.e.\quad there\quad is\quad no\quad prefered\quad habit\quad for\quad deer\quad to\quad forage\quad in,\\\quad and\quad the\quad observed\quad counts\quad reflect\quad natural\quad sampling\quad fluctuations\\ \quad \\ { H }_{ A }:\quad The\quad observed\quad data\quad is\quad not\quad the\quad result\quad of\quad a\quad random\quad sample,\\\quad i.e.\quad there\quad is\quad a\quad bias\quad in\quad the\quad preference\quad of\quad foraged\quad areas$$

####(b) What type of test can we use to answer this research question?

Answer:

We can use a chi-square test.

####(c) Check if the assumptions and conditions required for this test are satisfied.

Answer:

The conditions for inference for a chi-square test is as follows:

1. Independence: Each case that contributes a count to the table must be independent of all the other cases in the table.

Assuming that the study has a way of tracking the deer separately, it can be assumed each count of deer contributes a count to the table that is independent of other cases.

2. Sample size / distribution: Each particular scenario (i.e. cell count) must have at least 5 expected cases.

```{r}
total_deer <- 426
woods_area <- 0.048
grassplot_area <- 0.147
forest_area <- 0.396
other_area <- 1 - woods_area - grassplot_area - forest_area
woods_expected <- woods_area * total_deer
grassplot_expected <- grassplot_area * total_deer
forest_expected <- forest_area * total_deer
other_expected <- other_area * total_deer
```


There is one scenario that may not meet the requirements (Woods = 4); however, the expected number of deer in the woods area is 20.4, which is over the minimum of 5, so we can continue.

####(d) Do these data provide convincing evidence that barking deer prefer to forage in certain habitats over others? Conduct an appropriate hypothesis test to answer this research question.

Answer:

```{r}
chisq_woods <- (4 - woods_expected)^2 / woods_expected
chisq_grassplot <- (16 - grassplot_expected)^2 / grassplot_expected
chisq_forest <- (67 - forest_expected)^2 / forest_expected
chisq_other <- (345 - other_expected)^2 / other_expected
chi_square_value <- chisq_woods + chisq_grassplot + chisq_forest + chisq_other
df_chi_square <- 5 - 1
pchisq(q = chi_square_value, df = df_chi_square,lower.tail = FALSE)

lb <- 0
ub <- 300
z1 <- round(chi_square_value, digits = 2)
z2 <- round(chi_square_value, digits = 2)
pick_line1 <- z1
pick_line2 <- z2
ggplot(data.frame(x = c(lb, ub)), aes(x))+ stat_function(fun = dchisq, args = list(df=df_chi_square))  + stat_function(fun = dchisq, args = list(df=df_chi_square), xlim = c(z1, ub),geom = "area", alpha=0.5)+geom_vline(xintercept=pick_line1, color = "black", alpha = 0.75)+geom_text(aes(x=pick_line1, y=0.1, label=sprintf("Chi-square = %s\n", pick_line1)), color="black", angle=90)+geom_vline(xintercept=pick_line2, color = "black", alpha = 0.75)+geom_text(aes(x=pick_line2, y=0.1, label=sprintf("Chi-square = %s\n", pick_line2)), color="black", angle=90) + labs(x="Chi Square Value")
```

Using a 95% confidence level, there is singificant evidence to reject the null hypothesis that barking deer do not prefer to forage in certain habitats over others.

####6.48 Coffee and Depression. Researchers conducted a study investigating the relationship between caffeinated co↵ee consumption and risk of depression in women. They collected data on 50,739 women free of depression symptoms at the start of the study in the year 1996, and these women were followed through 2006. The researchers used questionnaires to collect data on ca↵einated co↵ee consumption, asked each individual about physician-diagnosed depression, and also asked about the use of antidepressants. The table below shows the distribution of incidences of depression by amount of caffeinated coffee consumption.

####(a) What type of test is appropriate for evaluating if there is an association between coffee intake and depression?

Answer:

A chi-square test for two way tables

####(b) Write the hypotheses for the test you identified in part (a).

Answer:

HO: There is no difference in the clinical depression rates of women between the groups of caffeinated coffee consumption.

HA; There is some difference in the clinical depression rates of women between the groups of caffeinated coffee consumption.

####(c) Calculate the overall proportion of women who do and do not suffer from depression.

Answer:

```{r}
depression_yes <- round(2607 / 50739, digits = 2)
depression_no <- round(48132 / 50739, digits = 2)
```

The proportion of women in this test who suffer from depression is `r depression_yes` and the proportion who do not suffer from depression is `r depression_no`.

####(d) Identify the expected count for the highlighted cell, and calculate the contribution of this cell to the test statistic, i.e. (Observed − Expected)2/Expected.

Answer:

```{r}
row1_total <- 2607
table_total <- 50739
column2_total <- 6627
expected_count <- (row1_total / table_total) * column2_total
test_statistic <- (373 - expected_count)^2 / expected_count
test_statistic
```


####(e) The test statistic is #2 = 20.93. What is the p-value?

Answer:

First, we must determine the degrees of freedom:

```{r}
table_rows <- 2
table_columns <- 5
df_table <- (table_rows-1) * (table_columns-1)
```

Now, we can deterime the p-value of the chi-square quantile:

```{r}
p_value <- pchisq(q = 20.93, df = df_table, lower.tail = FALSE)

lb <- 0
ub <- 35
z1 <- 20.93
z2 <- 20.93
pick_line1 <- z1
pick_line2 <- z2
ggplot(data.frame(x = c(lb, ub)), aes(x))+ stat_function(fun = dchisq, args = list(df=df_chi_square))  + stat_function(fun = dchisq, args = list(df=df_chi_square), xlim = c(z1, ub),geom = "area", alpha=0.5)+geom_vline(xintercept=pick_line1, color = "black", alpha = 0.75)+geom_text(aes(x=pick_line1, y=0.1, label=sprintf("Chi-square = %s\n", pick_line1)), color="black", angle=90)+geom_vline(xintercept=pick_line2, color = "black", alpha = 0.75)+geom_text(aes(x=pick_line2, y=0.1, label=sprintf("Chi-square = %s\n", pick_line2)), color="black", angle=90) + labs(x="Chi Square Value")
```

The p-value is `r format(round(p_value, digits = 6), nsmall = 6)`

####(f) What is the conclusion of the hypothesis test?

Answer:

The p-value is less than a significance level of $\alpha = 0.05$; therefore, we reject the null hypothesis that there is no difference in the clinical depression rates of women between the groups of caffeinated coffee consumption.

####(g) One of the authors of this study was quoted on the NYTimes as saying it was “too early to recommend that women load up on extra coffee” based on just this study. Do you agree with this statement? Explain your reasoning.

Answer:

Yes, a two-way table chi-square test only determines goodness of fit, in this case whether each group is represntative of the population.  Therefore, no further conclusions can be drawn from this analysis other than whether the data do or do not have the same distribution for each group as the general population.